---
title: 两行代码修复了解析MySQL8.x  binlog错位的问题！！
categories: 精通MySQL系列
tags: binlog解析 MySQL8.x 二进制日志 mykit-data 数据异构
---
## 写在前面

MySQL是互联网行业使用的最多的关系型数据库之一，而且MySQL又是开源的，对于MySQL的深入研究，能够加深我们对于数据库原理的理解。自从开源了mykit-
data之后，不少小伙伴试用后，反馈mykit-data无法正确的解析MySQL8的binlog。于是我测试了下，mykit-
data在解析MySQL5.x的binlog时，没有啥问题，能够正确的解析出结果数据。然而，在解析MySQL8.x的binlog时，总是与binlog日志位数相差12位而导致解析失败。

文章已收录到：

https://github.com/sunshinelyz/technology-binghe

https://gitee.com/binghe001/technology-binghe

## 问题修复

今天太晚了，我还在研究MySQL 8.0.20的源码，问题的修复过程后续再写一篇详细的文章来与小伙伴们分享下。这里，我就直接说我是如何解决这个问题的。

MySQL5.x binlog的解析结果与MySQL8.x binlog的解析结果总是存在位数偏差，框架原本的代码直接解析MySQL
5.x是没啥问题的，在解析MySQL 8.x的时候出现位数错误。

期间，我几乎翻阅了MySQL的所有官方文档，把mykit-
data中关于解析binlog日志的功能重新写了一遍，解析MySQL5.x没问题，解析MySQL8.x还是错位。

到底哪里出了问题呢？就在对于问题的解决一筹莫展的时候，突然， **想到一个思路：解决MySQL8.x
binlog的时候不是总错位吗？那我就把多余位数的binlog数据读取出来，直接忽略掉，使后续binlog的解析操作对齐不就行了吗？**

赶紧尝试一下，于是我在mykit-data框架的源码中，添加了如下代码。

![在这里插入图片描述](data:image/png;base64,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)

上面代码是对解析MySQL
binlog位数的校验和读取的封装，当读取的binlog位数未达到读取的限制位数时，一直读取binlog的数据，直到读取的binlog位数达到读取的限制位数位置。具体内部的逻辑，小伙伴们可以阅读mykit-
data的源码。

加上这个逻辑后，进行测试验证，解析MySQL 8.x数据库的binlog竟然成功了！！ **困扰我几天的问题就这么在不经意间解决了！！**

**从解决这个问题的结果来看，MySQL8.x的binlog在本质上比MySQL5.x的binlog位数要长，中间会拼接用来分隔不同事件位的标识，我们在解析MySQL8.x的binlog日志时，可直接忽略掉这些分隔不同事件位的标识，目的就是让binlog的解析位对齐，从而能够正确的解析出下一个事件。而这样处理，也不会影响解析结果。**

很多时候就是这样，当你苦于解决某个问题，迟迟找不到解决方案而一筹莫展时，在某个不经意的瞬间，就会无意中解决这个棘手的问题，但前提是你需要深刻理解它的原理并尝试各种方式和方法来解决它！

## 关于mykit-data

mykit-
data是一款完全开源的数据异构中间件，支持插件化、可视化的数据异构框架，支持MySQL到MySQL、MySQL到Oracle、Oracle到MySQL、Oracle到Oracle的全量、实时/定时增量数据同步。完全的插件化、可视化操作。通过日志最大限度的避免同步过程中的数据丢失。支持失败重试，人工干预，支持查看同步的数据和详细的日志信息。

目前支持MySQL5.x、MySQL8.x，Oracle 11g及以上版本。后续会以插件的形式支持更多的异构数据源。

mykit-data的开源地址如下：

GitHub：https://github.com/sunshinelyz/mykit-data

Gitee：https://gitee.com/binghe001/mykit-data

最后，小伙伴们为这款开源项目点个Star呀！！

**好了，今天就到这儿吧，我是冰河，大家有啥问题可以在下方留言，也可以加我微信：sun_shine_lyz，一起交流技术，一起进阶，一起牛逼~~**

