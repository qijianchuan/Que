---
title: Java调用Jython的方法
categories: 1、JAVA基础
tags: jython java string 脚本 null
---
1、一个可以和 Jython 对象映射的 Java 借口类

  1. package com.newbee;
  2.   3. public interface EmployeeType {
  4.   5. public String getEmployeeFirst();
  6. public String getEmployeeLast();
  7. public String getEmployeeId();
  8. public void setEmployeeId();
  9.   10. }
  11. 

  
2、一个从 Jython 文件中获取 Java对象、Jython对象和 Jython函数对象的工厂方法类  

  1. package com.newbee;
  2.   3. import java.util.HashMap;
  4.   5. import org.python.core.PyFunction;
  6. import org.python.core.PyObject;
  7. import org.python.util.PythonInterpreter;
  8.   9. public class JythonFactory {
  10.   11. private static final JythonFactory instance = new JythonFactory();
  12. private static final HashMap<String, PythonInterpreter> piMap = new HashMap<String, PythonInterpreter>();
  13.   14. public static JythonFactory getInstance() {
  15. return instance;
  16. }
  17.   18. public Object getJavaObjectFromJythonFile(String interfaceName, String pathToJythonModule) {
  19.   20. Object javaObject = null;
  21.   22. PythonInterpreter interpreter = cacheInterpreter(pathToJythonModule);
  23.   24. String tempName = pathToJythonModule.substring(pathToJythonModule.lastIndexOf("/") + 1);
  25. tempName = tempName.substring(0, tempName.indexOf("."));
  26. System.out.println(tempName);
  27. String instanceName = tempName.toLowerCase();
  28. String javaClassName = tempName.substring(0, 1).toUpperCase() + tempName.substring(1);
  29. String objectDef = "=" \+ javaClassName + "()";
  30. interpreter.exec(instanceName + objectDef);
  31. try {
  32. Class JavaInterface = Class.forName(interfaceName);
  33. javaObject = interpreter.get(instanceName).__tojava__(JavaInterface);
  34. } catch (ClassNotFoundException ex) {
  35. ex.printStackTrace(); // Add logging here
  36. }
  37.   38. return javaObject;
  39. }
  40.   41. public PyObject getPyObjectFromJythonFile(String typeName, String pathToJythonModule) {
  42.   43. PyObject pyObject = null;
  44. PythonInterpreter interpreter = cacheInterpreter(pathToJythonModule);
  45.   46. String instanceName = typeName.toLowerCase();
  47. String objectDef = "=" \+ typeName + "()";
  48. interpreter.exec(instanceName + objectDef);
  49. pyObject = interpreter.get(instanceName);
  50.   51. return pyObject;
  52. }
  53.   54. public PyFunction getPyFunctionFromJythonFile(String funcName, String pathToJythonModule) {
  55.   56. PyFunction pyFunction = null;
  57. PythonInterpreter interpreter = cacheInterpreter(pathToJythonModule);
  58. pyFunction = (PyFunction)interpreter.get(funcName,PyFunction.class); 
  59.   60. return pyFunction;
  61. }
  62.   63. private PythonInterpreter cacheInterpreter(String pathToJythonModule) {
  64. PythonInterpreter interpreter = null;
  65. if (piMap.get(pathToJythonModule)!=null) {
  66. interpreter = piMap.get(pathToJythonModule);
  67. } else {
  68. interpreter = new PythonInterpreter();
  69. interpreter.execfile(pathToJythonModule);
  70. }
  71. return interpreter;
  72. }
  73.   74. }

3、Jython脚本文件 Employee.py  

  1. # Jython source file
  2. from com.newbee import EmployeeType
  3.   4. class Employee(EmployeeType):
  5. def __init__(self):
  6. self.first = "Sean"
  7. self.last = "Guo"
  8. self.id = "731"
  9. def getEmployeeFirst(self):
  10. return self.first
  11.   12. def getEmployeeLast(self):
  13. return self.last
  14.   15. def getEmployeeId(self):
  16. return self.id
  17.   18. def setEmployeeId(self, newId):
  19. self.id = newId
  20.   21. def getNunmberValue(seed):
  22. v0 = 0
  23. for i in range(1,seed+1):
  24. v0 +=i
  25. return v0

4、使用上述类的方法  

  1. package com.newbee;
  2.   3. import java.util.regex.Matcher;
  4. import java.util.regex.Pattern;
  5.   6. import org.python.core.PyException;
  7. import org.python.core.PyFunction;
  8. import org.python.core.PyInteger;
  9. import org.python.core.PyObject;
  10. import org.python.core.PyString;
  11.   12. public class SimpleEmbedded {
  13. public static void main(String[] args) throws PyException {
  14.   15. // Java
  16. EmployeeType eType = (EmployeeType) JythonFactory.getInstance().getJavaObjectFromJythonFile("com.newbee.EmployeeType", "jylib/Employee.py");
  17. System.out.println("Employee Name: " \+ eType.getEmployeeFirst() + " " \+ eType.getEmployeeLast());
  18. System.out.println("Employee ID: " \+ eType.getEmployeeId());
  19.   20. // Jython
  21. PyObject pyObject = JythonFactory.getInstance().getPyObjectFromJythonFile("Employee", "jylib/Employee.py");
  22. System.out.println("+++="+pyObject.invoke("getEmployeeId"));
  23. pyObject.invoke("setEmployeeId",new PyString("1999"));
  24. System.out.println("+++="+pyObject.invoke("getEmployeeId"));
  25.   26. // Jython Function
  27. PyFunction pyFunction = JythonFactory.getInstance().getPyFunctionFromJythonFile("getNunmberValue", "jylib/Employee.py");
  28. System.out.println("***="+pyFunction.__call__(new PyInteger(10)));
  29.   30. }
  31. }

  

