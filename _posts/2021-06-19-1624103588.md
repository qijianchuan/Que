---
title: spring项目整合redis
categories: Spring
tags: redis spring
---
# spring项目整合redis

之前利用xml配置过spring-data-redis，但是在实际的项目中，兼容性不是很好。先在看一个实际项目中整合redis的案例。

### 1 首先pom.xml引入依赖

    
    
            <!--redis客户端 jedis-->
            <dependency>
                <groupId>redis.clients</groupId>
                <artifactId>jedis</artifactId>
                <version>2.8.1</version>
            </dependency>
            <!--spring-data-redis jedis-->
            <dependency>
                <groupId>org.springframework.data</groupId>
                <artifactId>spring-data-redis</artifactId>
                <version>1.6.4.RELEASE</version>
            </dependency>
            <!--json、javabean、xml转换-->
            <dependency>
                <groupId>de.odysseus.staxon</groupId>
                <artifactId>staxon</artifactId>
                <version>1.3</version>
            </dependency>

### 2 在resources包下创建配置文件

config.properties

    
    
    #是否使用redis(true或false)
    system.redis.isUseRedis=true
    
    #redis模式(哨兵模式:sentinel;单机模式:standalone)
    system.redis.mode=standalone
    
    #spring cache集成模式(redisCache或ehcache)
    system.cache.mode=redisCache
    
    #缓存选择redis时的超时时间(单位:秒)
    system.cache.redis.timeout=3000
    

redis.properties

    
    
    #redis standalone配置
    redis.host=10.110.13.243
    redis.port=6379
    redis.password=shirukai
    
    #redis sentinel配置
    
    #redis 连接池配置
    #最大连接数(默认:8)
    redis.pool.maxTotal=600
    #最大空闲数(默认:8)
    redis.pool.maxIdle=300
    #当连接池资源耗尽时,调用者最大阻塞时间,超时将抛出异常.单位:毫秒,默认:-1,表示永不超时.
    redis.pool.maxWaitMillis=1000
    #指明是否在从池中取出连接前进行检验,如果检验失败,则从池中去除连接并尝试取出另一个 (默认:false)
    redis.pool.testOnBorrow=true

### 3 创建包目录

在controller、dao层的同级目录下，创建redis包。

在redis包下创建

entity包

redisDao包

util包

目录结构如图

![](data:image/png;base64,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)

### 4 创建包扫描自动创建bean

在spring的配置文件中添加包扫描 (如果项目中之前在这个目录下创建过包扫描，则不需要再次设置，否则会报错。)

loushagn框架已经扫描，所以无需添加

    
    
    <context:component-scan base-package="kb.redis.redisDao" />

### 5 创建SpringContexHolder上下文类

默认loushang已经创建

    
    
    //
    // Source code recreated from a .class file by IntelliJ IDEA
    // (powered by Fernflower decompiler)
    //
    
    package org.loushang.framework.util;
    
    import org.loushang.framework.i18n.MessageSourceExt;
    import org.slf4j.Logger;
    import org.slf4j.LoggerFactory;
    import org.springframework.beans.factory.DisposableBean;
    import org.springframework.context.ApplicationContext;
    import org.springframework.context.ApplicationContextAware;
    
    public class SpringContextHolder implements ApplicationContextAware, DisposableBean {
        private static ApplicationContext applicationContext = null;
        private static Logger logger = LoggerFactory.getLogger(SpringContextHolder.class);
    
        public SpringContextHolder() {
        }
    
        public static ApplicationContext getApplicationContext() {
            assertContextInjected();
            return applicationContext;
        }
    
        public static <T> T getBean(String name) {
            assertContextInjected();
            return applicationContext.getBean(name);
        }
    
        public static void clearHolder() {
            applicationContext = null;
        }
    
        public void setApplicationContext(ApplicationContext applicationContext) {
            if (applicationContext != null) {
                logger.warn(MessageSourceExt.getLocaleMessage("framework.util.034", "SpringContextHolder中的ApplicationContext被覆盖, 原有ApplicationContext为:") + applicationContext);
            }
    
            applicationContext = applicationContext;
        }
    
        public void destroy() throws Exception {
            clearHolder();
        }
    
        private static void assertContextInjected() {
            if (applicationContext == null) {
                logger.error(MessageSourceExt.getLocaleMessage("framework.util.035", "applicaitonContext属性未注入, 请在WEB-INF/spring/spring-context.xml中定义SpringContextHolder."));
                throw new RuntimeException(MessageSourceExt.getLocaleMessage("framework.util.035", "applicaitonContext属性未注入, 请在WEB-INF/spring/spring-context.xml中定义SpringContextHolder."));
            }
        }
    }

### 6 配置SpringContexHolder

楼上配置文件中默认已经启用

    
    
         <!-- spring上下文工具 -->                
        <bean class="org.loushang.framework.util.SpringContextHolder" lazy-init="false" />

非loushang的话可以自己在spring配置文件中，配置bean。创建一个类，然后选择类路径即可。

### 7 创建redis工具类

#### 7.1 在redis/utils包下创建

##### 7.1.1 JsonInput类

JsonInput.java

    
    
    package kb.redis.util;
    
    import java.io.Serializable;
    import java.util.List;
    import java.util.Map;
    
    /**
     * json输入对象
     */
    public class JsonInput implements Serializable {
        private static final long serialVersionUID = 6479304251080435277L;
    
        private String appKey;
        private String secretKey;
        private String appType;
        private String signatureInfo;
        private String timeStamp;
        private String tranSeq;
        private String tranId;
        private int queueId;
        private List<Map<String, Object>> body;
    
        public JsonInput() {
    
        }
    
        public JsonInput(String appKey, String secretKey, String appType, String signatureInfo, String timeStamp,
                String tranSeq, String tranId, int queueId, List<Map<String, Object>> body) {
            super();
            this.appKey = appKey;
            this.secretKey = secretKey;
            this.appType = appType;
            this.signatureInfo = signatureInfo;
            this.timeStamp = timeStamp;
            this.tranSeq = tranSeq;
            this.tranId = tranId;
            this.queueId = queueId;
            this.body = body;
        }
    
        public String getAppKey() {
            return appKey;
        }
    
        public void setAppKey(String appKey) {
            this.appKey = appKey;
        }
    
        public String getSecretKey() {
            return secretKey;
        }
    
        public void setSecretKey(String secretKey) {
            this.secretKey = secretKey;
        }
    
        public String getAppType() {
            return appType;
        }
    
        public void setAppType(String appType) {
            this.appType = appType;
        }
    
        public String getSignatureInfo() {
            return signatureInfo;
        }
    
        public void setSignatureInfo(String signatureInfo) {
            this.signatureInfo = signatureInfo;
        }
    
        public String getTimeStamp() {
            return timeStamp;
        }
    
        public void setTimeStamp(String timeStamp) {
            this.timeStamp = timeStamp;
        }
    
        public String getTranSeq() {
            return tranSeq;
        }
    
        public void setTranSeq(String tranSeq) {
            this.tranSeq = tranSeq;
        }
    
        public List<Map<String, Object>> getBody() {
            return body;
        }
    
        public void setBody(List<Map<String, Object>> body) {
            this.body = body;
        }
    
        public String test(String json) {
    
            return json;
        }
    
        public String getTranId() {
            return tranId;
        }
    
        public void setTranId(String tranId) {
            this.tranId = tranId;
        }
    
        public int getQueueId() {
            return queueId;
        }
    
        public void setQueueId(int queueId) {
            this.queueId = queueId;
        }
    
    }
    

##### 7.1.2 JsonOutput类

JsonOutput.java

    
    
    package kb.redis.util;
    
    import java.io.Serializable;
    import java.util.ArrayList;
    import java.util.List;
    import java.util.Map;
    
    /**
     * json输出对象
     */
    public class JsonOutput implements Serializable {
       private static final long serialVersionUID = -8836237657941280022L;
    
       private String timeStamp;
       private String tranSeq;
       private String tranId;
    
       private String rtnCode;
       private String code;
       private String message;
       private String signatureInfo;
       private List<Map<String, Object>> body;
    
       public JsonOutput() {
    
       }
    
       public JsonOutput(String rtnCode, String code, String message) {
          super();
          this.rtnCode = rtnCode;
          this.code = code;
          this.message = message;
          this.timeStamp = "";
          this.tranSeq = "";
          this.tranId = "";
          this.signatureInfo = "";
          this.body = new ArrayList<Map<String, Object>>();
       }
    
       public JsonOutput(String timeStamp, String tranSeq, String tranId, String rtnCode, String code, String message,
             String signatureInfo, List<Map<String, Object>> body) {
          super();
          this.timeStamp = timeStamp;
          this.tranSeq = tranSeq;
          this.tranId = tranId;
          this.rtnCode = rtnCode;
          this.code = code;
          this.message = message;
          this.signatureInfo = signatureInfo;
          this.body = body;
       }
    
       public String getTimeStamp() {
          return timeStamp;
       }
    
       public void setTimeStamp(String timeStamp) {
          this.timeStamp = timeStamp;
       }
    
       public String getTranSeq() {
          return tranSeq;
       }
    
       public void setTranSeq(String tranSeq) {
          this.tranSeq = tranSeq;
       }
    
       public String getRtnCode() {
          return rtnCode;
       }
    
       public void setRtnCode(String rtnCode) {
          this.rtnCode = rtnCode;
       }
    
       public String getCode() {
          return code;
       }
    
       public void setCode(String code) {
          this.code = code;
       }
    
       public String getMessage() {
          return message;
       }
    
       public void setMessage(String message) {
          this.message = message;
       }
    
       public List<Map<String, Object>> getBody() {
          return body;
       }
    
       public void setBody(List<Map<String, Object>> body) {
          this.body = body;
       }
    
       public String getTranId() {
          return tranId;
       }
    
       public void setTranId(String tranId) {
          this.tranId = tranId;
       }
    
       public String getSignatureInfo() {
          return signatureInfo;
       }
    
       public void setSignatureInfo(String signatureInfo) {
          this.signatureInfo = signatureInfo;
       }
    
    }

##### 7.1.3 JsonUtil类

JsonUtil.java

    
    
    package kb.redis.util;
    
    import com.fasterxml.jackson.core.JsonParseException;
    import com.fasterxml.jackson.core.JsonProcessingException;
    import com.fasterxml.jackson.databind.JsonMappingException;
    import com.fasterxml.jackson.databind.ObjectMapper;
    import de.odysseus.staxon.json.JsonXMLConfig;
    import de.odysseus.staxon.json.JsonXMLConfigBuilder;
    import de.odysseus.staxon.json.JsonXMLInputFactory;
    import de.odysseus.staxon.json.JsonXMLOutputFactory;
    import de.odysseus.staxon.xml.util.PrettyXMLEventWriter;
    import org.slf4j.Logger;
    import org.slf4j.LoggerFactory;
    
    import javax.xml.stream.XMLEventReader;
    import javax.xml.stream.XMLEventWriter;
    import javax.xml.stream.XMLInputFactory;
    import javax.xml.stream.XMLOutputFactory;
    import java.io.IOException;
    import java.io.StringReader;
    import java.io.StringWriter;
    import java.util.Map;
    
    /**
     * json工具类
     */
    public final class JsonUtil {
    
        private JsonUtil() {
        }
    
        private static final Logger LOG = LoggerFactory.getLogger(JsonUtil.class);
    
        /**
         * object转换为json字符串
         *
         * @param object 要转换的对象
         * @return 转换后的json字符串
         */
        public static String objectToJsonStr(Object object) {
            ObjectMapper om = new ObjectMapper();
            try {
                return om.writeValueAsString(object);
            } catch (JsonProcessingException e) {
                LOG.error(e.getMessage());
                return null;
            }
        }
    
        /**
         * json字符串转换为指定类型的对象
         *
         * @param <T>       Type Java类
         * @param jsonStr   要转换的json字符串
         * @param valueType 指定的对象类型
         * @return 转换后的对象
         */
        public static <T> T jsonStrToObject(String jsonStr, Class<T> valueType) {
            ObjectMapper om = new ObjectMapper();
            try {
                return om.readValue(jsonStr, valueType);
            } catch (JsonParseException e) {
                LOG.error(e.getMessage());
                return null;
            } catch (JsonMappingException e) {
                LOG.error(e.getMessage());
                return null;
            } catch (IOException e) {
                LOG.error(e.getMessage());
                return null;
            } catch (NullPointerException e) {
                LOG.error(e.getMessage());
                return null;
            }
        }
    
        /**
         * 将xml字符串转换为json字符串
         *
         * @param xmlStr 要转换的xml字符串
         * @return 转换后的json字符串
         */
        public static String xmlStrToJsonStr(String xmlStr) {
            StringReader input = new StringReader(xmlStr);
            StringWriter output = new StringWriter();
            JsonXMLConfig config = new JsonXMLConfigBuilder().autoArray(true).autoPrimitive(true).prettyPrint(true).build();
            try {
                XMLEventReader reader = XMLInputFactory.newInstance().createXMLEventReader(input);
                XMLEventWriter writer = new JsonXMLOutputFactory(config).createXMLEventWriter(output);
                writer.add(reader);
                reader.close();
                writer.close();
            } catch (Exception e) {
                LOG.error(e.getMessage());
            } finally {
                try {
                    output.close();
                    input.close();
                } catch (IOException e) {
                    LOG.error(e.getMessage());
                }
            }
            return output.toString();
        }
    
        /**
         * 将json字符串转换为xml字符串
         *
         * @param jsonStr 要转换的json字符串
         * @return 转换后的xml字符串
         */
        public static String jsonStrToXmlStr(String jsonStr) {
            StringReader input = new StringReader(jsonStr);
            StringWriter output = new StringWriter();
            JsonXMLConfig config = new JsonXMLConfigBuilder().multiplePI(false).repairingNamespaces(false).build();
            try {
                XMLEventReader reader = new JsonXMLInputFactory(config).createXMLEventReader(input);
                XMLEventWriter writer = XMLOutputFactory.newInstance().createXMLEventWriter(output);
                writer = new PrettyXMLEventWriter(writer);
                writer.add(reader);
                reader.close();
                writer.close();
            } catch (Exception e) {
                LOG.error(e.getMessage());
            } finally {
                try {
                    output.close();
                    input.close();
                } catch (IOException e) {
                    LOG.error(e.getMessage());
                }
            }
            /**
             * remove <?xml version='1.0'?> return output.toString().substring(22);
             */
            return output.toString();
        }
    
        /**
         * JsonInput对象完整性校验
         *
         * @param jsonInput 要检验的JsonInput对象
         * @return JsonOutput
         */
        public static JsonOutput validateJson(JsonInput jsonInput) {
            String rtnCode = "3";
            String code = "3000";
            String message = "fail";
            if (jsonInput == null) {
                message = "inputJson not received.";
            } else if (jsonInput.getAppKey() == null) {
                message = "appKey is required.";
            } else if (jsonInput.getAppType() == null) {
                message = "appType is required.";
            } else if (jsonInput.getBody() == null) {
                message = "body is required.";
            } else if (jsonInput.getSecretKey() == null) {
                message = "secretKey is required.";
            } else if (jsonInput.getSignatureInfo() == null) {
                message = "signatureInfo is required.";
            } else if (jsonInput.getTimeStamp() == null) {
                message = "timeStamp is required.";
            } else if (jsonInput.getTranId() == null) {
                message = "tranId is required.";
            } else if (jsonInput.getTranSeq() == null) {
                message = "tranSeq is required.";
            } else {
                rtnCode = "0";
                code = "0000";
                message = "success";
            }
            JsonOutput jo = new JsonOutput(rtnCode, code, message);
            return jo;
        }
    
        /**
         * json字符串转换为map
         *
         * @param jsonStr 要转换的json字符串
         * @return 转换后的map
         */
        public static Map<?, ?> jsonStrToMap(String jsonStr) {
            try {
                ObjectMapper om = new ObjectMapper();
                return om.readValue(jsonStr, Map.class);
            } catch (Exception e) {
                LOG.error(e.getMessage());
                return null;
            }
        }
    
        /**
         * 格式化json字符串
         *
         * @param jsonStr 要格式化的json字符串
         * @return 格式化后的json字符串
         */
        public static String formatJsonStr(String jsonStr) {
            try {
                ObjectMapper om = new ObjectMapper();
                return om.writerWithDefaultPrettyPrinter().writeValueAsString(jsonStrToMap(jsonStr));
            } catch (Exception e) {
                LOG.error(e.getMessage());
                return null;
            }
        }
    
    }

##### 7.1.4 PropertiesLoader类

用于加载resources包的配置文件的

PropertiesLoader.java

    
    
    package kb.redis.util;
    
    import org.springframework.core.io.DefaultResourceLoader;
    import org.springframework.core.io.Resource;
    import org.springframework.core.io.ResourceLoader;
    
    import java.io.IOException;
    import java.io.InputStream;
    import java.util.NoSuchElementException;
    import java.util.Properties;
    
    /**
     * 用以加载配置文件
     */
    public class PropertiesLoader {
        private static ResourceLoader resourceLoader = new DefaultResourceLoader();
    
        private final Properties properties;
    
        public PropertiesLoader(String... resourcesPaths) {
            properties = loadProperties(resourcesPaths);
        }
    
        public Properties getProperties() {
            return properties;
        }
    
        /**
         * 取出Property,但以System的Property优先.取不到返回空字符串
         *
         * @param key Property键
         * @return String类型的Property值
         */
        private String getValue(String key) {
            String systemProperty = System.getProperty(key);
            if (systemProperty != null) {
                return systemProperty;
            }
            if (properties.containsKey(key)) {
                return properties.getProperty(key);
            }
            return "";
        }
    
        /**
         * 取出String类型的Property,但以System的Property优先,如果都为Null则抛出异常
         *
         * @param key Property键
         * @return String类型的Property值
         */
        public String getProperty(String key) {
            String value = getValue(key);
            if (value == null) {
                throw new NoSuchElementException();
            }
            return value;
        }
    
        /**
         * 取出String类型的Property,但以System的Property优先.如果都为Null则返回Default值
         *
         * @param key          Property键
         * @param defaultValue Default值
         * @return String类型的Property值
         */
        public String getProperty(String key, String defaultValue) {
            String value = getValue(key);
            return value != null ? value : defaultValue;
        }
    
        /**
         * 取出Integer类型的Property,但以System的Property优先.如果都为Null或内容错误则抛出异常
         *
         * @param key Property键
         * @return Integer类型的Property值
         */
        public Integer getInteger(String key) {
            String value = getValue(key);
            if (value == null) {
                throw new NoSuchElementException();
            }
            return Integer.valueOf(value);
        }
    
        /**
         * 取出Integer类型的Property,但以System的Property优先.如果都为Null则返回Default值,如果内容错误则抛出异常
         *
         * @param key          Property键
         * @param defaultValue Default值
         * @return Integer类型的Property值
         */
        public Integer getInteger(String key, Integer defaultValue) {
            String value = getValue(key);
            return value != null ? Integer.valueOf(value) : defaultValue;
        }
    
        /**
         * 取出Long类型的Property,但以System的Property优先.如果都为Null或内容错误则抛出异常
         *
         * @param key Property键
         * @return Long类型的Property值
         */
        public Long getLong(String key) {
            String value = getValue(key);
            if (value == null) {
                throw new NoSuchElementException();
            }
            return Long.valueOf(value);
        }
    
        /**
         * 取出Long类型的Property,但以System的Property优先.如果都为Null则返回Default值,如果内容错误则抛出异常
         *
         * @param key          Property键
         * @param defaultValue Default值
         * @return Long类型的Property值
         */
        public Long getLong(String key, Long defaultValue) {
            String value = getValue(key);
            return value != null ? Long.valueOf(value) : defaultValue;
        }
    
        /**
         * 取出Double类型的Property,但以System的Property优先.如果都为Null或内容错误则抛出异常
         *
         * @param key Property键
         * @return Double类型的Property值
         */
        public Double getDouble(String key) {
            String value = getValue(key);
            if (value == null) {
                throw new NoSuchElementException();
            }
            return Double.valueOf(value);
        }
    
        /**
         * 取出Double类型的Property,但以System的Property优先.如果都为Null则返回Default值,如果内容错误则抛出异常
         *
         * @param key          Property键
         * @param defaultValue Default值
         * @return Double类型的Property值
         */
        public Double getDouble(String key, Integer defaultValue) {
            String value = getValue(key);
            return value != null ? Double.valueOf(value) : defaultValue;
        }
    
        /**
         * 取出Boolean类型的Property,但以System的Property优先.如果都为Null抛出异常,如果内容不是true/
         * false则返回false
         *
         * @param key Property键
         * @return Boolean类型的Property值
         */
        public Boolean getBoolean(String key) {
            String value = getValue(key);
            if (value == null) {
                throw new NoSuchElementException();
            }
            return Boolean.valueOf(value);
        }
    
        /**
         * 取出Boolean类型的Property,但以System的Property优先.如果都为Null则返回Default值,如果内容不为true/
         * false则返回false
         *
         * @param key          Property键
         * @param defaultValue Default值
         * @return Boolean类型的Property值
         */
        public Boolean getBoolean(String key, boolean defaultValue) {
            String value = getValue(key);
            return value != null ? Boolean.valueOf(value) : defaultValue;
        }
    
        /**
         * 载入多个文件,文件路径使用Spring Resource格式
         *
         * @param resourcesPaths 文件路径
         * @return Properties
         */
        private Properties loadProperties(String... resourcesPaths) {
            Properties props = new Properties();
    
            for (String location : resourcesPaths) {
                InputStream is = null;
                try {
                    Resource resource = resourceLoader.getResource(location);
                    is = resource.getInputStream();
                    props.load(is);
                } catch (IOException ex) {
                    ex.printStackTrace();
                } finally {
                    // IOUtils.closeQuietly(is);
                }
            }
            return props;
        }
    }
    

#### 7.2在redis/utils/redis包下创建

##### 7.2.1 redis连接类

提供两种连接模式：哨兵模式和单机模式

RedisConfig.java

    
    
    package kb.redis.utils.redis;
    
    import kb.redis.utils.PropertiesLoader;
    import org.springframework.beans.factory.annotation.Value;
    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;
    import org.springframework.data.redis.connection.RedisSentinelConfiguration;
    import org.springframework.data.redis.connection.jedis.JedisConnectionFactory;
    import org.springframework.data.redis.core.StringRedisTemplate;
    import org.springframework.data.redis.serializer.JdkSerializationRedisSerializer;
    import org.springframework.data.redis.serializer.StringRedisSerializer;
    import org.springframework.util.StringUtils;
    import redis.clients.jedis.JedisPoolConfig;
    
    /**
     * @ClassName: RedisConfig
     * @Description: redis配置
     */
    @Configuration
    public class RedisConfig {
    
        private final PropertiesLoader redisProperties = new PropertiesLoader("redis.properties");
    
        /**
         * redis的模式（哨兵模式:sentinel;单机模式:standalone）
         */
        @Value("${system.redis.mode}")
        private String redisMode;
    
        /**
         * @return
         * @Title: jedisPoolConfig
         * @Description: 配置连接池
         */
        @Bean
        public JedisPoolConfig jedisPoolConfig() {
    
            JedisPoolConfig jedisPoolConfig = new JedisPoolConfig();
    
            jedisPoolConfig.setMaxIdle(redisProperties.getInteger("redis.pool.maxIdle"));
            jedisPoolConfig.setMaxTotal(redisProperties.getInteger("redis.pool.maxTotal"));
            jedisPoolConfig.setMaxWaitMillis(redisProperties.getLong("redis.pool.maxWaitMillis"));
            jedisPoolConfig.setTestOnBorrow(redisProperties.getBoolean("redis.pool.testOnBorrow"));
    
            return jedisPoolConfig;
        }
    
        /**
         * @param jpc
         * @return
         * @Title: jedisConnectionFactory
         * @Description: 配置连接工厂
         */
        @Bean
        public JedisConnectionFactory jedisConnectionFactory(JedisPoolConfig jpc) {
    
            /**
             * 根据config.properties中system.redis.mode配置连接工厂(哨兵模式:sentinel;单机模式: standalone)
             */
            if ("sentinel".equals(redisMode)) {
    
                RedisSentinelConfiguration sentinelConfig = new RedisSentinelConfiguration(
                        redisProperties.getProperty("redis.sentinel.master"),
                        StringUtils.commaDelimitedListToSet(redisProperties.getProperty("redis.sentinel.hostAndPost")));
                return new JedisConnectionFactory(sentinelConfig, jpc);
            } else {
    
                JedisConnectionFactory jedisConnectionFactory = new JedisConnectionFactory();
                jedisConnectionFactory.setHostName(redisProperties.getProperty("redis.host"));
                jedisConnectionFactory.setPort(redisProperties.getInteger("redis.port"));
                jedisConnectionFactory.setPassword(redisProperties.getProperty("redis.password"));
                jedisConnectionFactory.setPoolConfig(jpc);
    
                return jedisConnectionFactory;
            }
        }
    
        /**
         * @param jcf
         * @return
         * @Title: stringRedisTemplate
         * @Description: 配置redis模板，用于操作redis
         */
        @Bean
        public StringRedisTemplate stringRedisTemplate(JedisConnectionFactory jcf) {
            StringRedisTemplate stringRedisTemplate = new StringRedisTemplate();
            stringRedisTemplate.setConnectionFactory(jcf);
            stringRedisTemplate.setKeySerializer(new StringRedisSerializer());
            stringRedisTemplate.setValueSerializer(new JdkSerializationRedisSerializer());
            return stringRedisTemplate;
        }
    
    }

##### 7.2.1 redis基本操作类

RedisBaseDao.java

    
    
    package kb.redis.utils.redis;
    import kb.redis.utils.JsonUtil;
    import kb.redis.utils.PropertiesLoader;
    import org.loushang.framework.util.SpringContextHolder;
    import org.springframework.data.redis.core.StringRedisTemplate;
    
    import java.util.concurrent.TimeUnit;
    
    /**
     * @ClassName: RedisBaseDao
     * @Description: 提供操作redis的方法
     */
    public abstract class RedisBaseDao {
    
        private static PropertiesLoader configProperties = new PropertiesLoader("config.properties");
    
        private static boolean isUseRedis = configProperties.getBoolean("system.redis.isUseRedis");
    
        private static StringRedisTemplate stringRedisTemplate = null;
    
        static {
            if (isUseRedis) {
                stringRedisTemplate = SpringContextHolder.getBean("stringRedisTemplate");
            }
        }
    
        /**
         * 向redis中插入永不过期的数据
         *
         * @param key    键
         * @param object 要存入的对象
         * @return 是否成功
         */
        protected boolean insert(String key, Object object) {
            if (isUseRedis) {
                stringRedisTemplate.opsForValue().set(key, JsonUtil.objectToJsonStr(object));
            }
            return isUseRedis;
        }
    
        /**
         * 向redis中插入含过期时间的数据(单位:秒)
         *
         * @param key     键
         * @param object  要存入的对象
         * @param timeout 超时时间
         * @return 是否成功3
         */
        protected boolean insert(String key, Object object, Long timeout) {
            if (isUseRedis) {
                stringRedisTemplate.opsForValue().set(key, JsonUtil.objectToJsonStr(object), timeout, TimeUnit.SECONDS);
            }
            return isUseRedis;
        }
    
        /**
         * 向redis中插入含过期时间的数据,需指定时间单位
         *
         * @param key     键
         * @param object  要存入的对象
         * @param timeout 超时时间
         * @param unit    时间单位
         * @return 是否成功
         */
        protected boolean insert(String key, Object object, Long timeout, TimeUnit unit) {
            if (isUseRedis) {
                stringRedisTemplate.opsForValue().set(key, JsonUtil.objectToJsonStr(object), timeout, unit);
            }
            return isUseRedis;
        }
    
        /**
         * 删除redis中指定的数据
         *
         * @param key 键
         * @return 是否成功
         */
        protected boolean delete(String key) {
            if (isUseRedis) {
                stringRedisTemplate.delete(key);
            }
            return isUseRedis;
        }
    
        /**
         * 获取redis中指定的数据，并以指定类型返回
         *
         * @param <T>       Type Java类
         * @param key       键
         * @param valueType redis中对象的类型
         * @return 在redis中对象
         */
        protected <T> T select(String key, Class<T> valueType) {
            if (isUseRedis) {
                String value = stringRedisTemplate.opsForValue().get(key);
                return value == null ? null : JsonUtil.jsonStrToObject(value, valueType);
            } else {
                return null;
            }
        }
    
        /**
         * 是否使用redis
         *
         * @return 是否使用redis
         */
        public boolean isUseRedis() {
            return isUseRedis;
        }
    
    }
    

### 8 创建RedisDao层

#### 8.1 在redis包下创建redisDao包

#### 8.2 在redisDao包下创建TestRedisByListDao接口

TestRedisByListDao.java

    
    
    package kb.redis.redisDao;
    
    import java.util.List;
    
    /**
     * 测试 插入、删除、获取 list格式
     * Created by shirukai on 2017/12/2.
     */
    public interface TestRedisByListDao {
        Boolean setListToRedis(String key,List list);
    
        Boolean delListFromRedis(String key);
    
        List getListFromRedis(String key);
    }
    

#### 8.3 创建TestRedisByListDao的实现类

TestRedisByListDaoImpl.java

    
    
    package kb.redis.redisDao;
    import kb.redis.utils.redis.RedisBaseDao;
    import org.springframework.stereotype.Repository;
    
    import java.util.List;
    
    /**
     * List操作
     * Created by shirukai on 2017/12/2.
     */
    @Repository
    public class TestRedisByListDaoImpl extends RedisBaseDao implements TestRedisByListDao {
        public static final String KEY = "INSPUR:KB";
    
        /**
         * 保存List
         *
         * @param key  key
         * @param list list
         * @return boolean
         */
        @Override
        public Boolean setListToRedis(String key, List list) {
            return insert(KEY + ":" + key, list);
        }
    
        /**
         * 删除key
         *
         * @param key key
         * @return boolean
         */
        @Override
        public Boolean delListFromRedis(String key) {
            return delete(KEY + ":" + key);
    
        }
    
        /**
         * 获取list
         *
         * @param key key
         * @return list
         */
        @Override
        public List getListFromRedis(String key) {
            return select(KEY + ":" + key,List.class);
        }
    }
    

### 9.单元测试

    
    
    package kb.redis.redisDao;
    
    import org.junit.Test;
    import org.junit.runner.RunWith;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.test.context.ContextConfiguration;
    import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
    
    import java.util.ArrayList;
    import java.util.HashMap;
    import java.util.List;
    import java.util.Map;
    
    import static org.junit.Assert.*;
    
    /**
     * 测试保存list到redis
     * Created by shirukai on 2017/12/2.
     */
    @RunWith(SpringJUnit4ClassRunner.class)
    @ContextConfiguration(locations = {"classpath*:spring-context.xml", "classpath*:mybatis-config.xml"})
    public class TestRedisByListDaoImplTest {
        @Autowired
        private TestRedisByListDao testRedisByListDao;
    
        @Test
        public void setListToRedis() throws Exception {
            List<Map<String,String>> list = new ArrayList<Map<String,String>>();
            Map<String,String> map = new HashMap<String,String>();
            map.put("key1","value1");
            map.put("key2","value2");
            list.add(map);
            list.add(map);
            String key = "list1";
            Boolean resulet = testRedisByListDao.setListToRedis(key,list);
            if (resulet){
                System.out.println("保存redis成功！");
            }else {
                System.out.println("保存失败！");
            }
    
        }
    
        @Test
        public void delListFromRedis() throws Exception {
        }
    
        @Test
        public void getListFromRedis() throws Exception {
            String key = "list1";
            List list = testRedisByListDao.getListFromRedis(key);
            if (list != null){
                System.out.println(list);
            }else {
                System.out.println("获取失败！");
            }
        }
    
    }

### 附加配置redis

下载redis后解压然后执行make命令进行编译

#### 设置redis可以远程访问：

修改redis目录下的redis.conf文件中的两处地方

第一处

69行注释掉 #bind 127.0.0.0

第二处

88行设置 protected-mode no

#### 设置redis密码

500行 requirepass shirukai

