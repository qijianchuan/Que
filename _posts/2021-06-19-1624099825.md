---
title: ubuntu装RTL8111/8168B网卡驱动
categories: linux
tags: 
---
给本本装了ubuntu，结果被上网的问题搞疯了  
表现为开机后有较小概率网卡能正常工作（这两天来N次能用的时候有2次）  
正常的时候网络连接信息显示都和win下一样  
不能联网的时候网络信息上全部显示0.0.0.0  
并且此时就算你拔掉网线，在任务栏的那个网络管理图标也没有任何反应  
  
我当时试过重新装驱动（先删除r8169模块，然后安装下载的官方驱动）  
但是每次重启之后就不管用了,看网络连接信息那儿驱动还是显示R8169。  
  
前两天在这个论坛上求助可是没有得到想要的答案。后来在ubuntu 英文站上找了个帖子，照着做了。重启之后一切OK.  
  
我对比了下他的步骤，发现自己少了安装驱动后的 那几步，造成重启之后安装的驱动不管用。  
  
现在把那帖子引过来。  
http://ubuntuforums.org/showthread.php? ... l8111+8168  
  

**引用:**

  
1) Check to see if the r8169 module is loaded  
-> lsmod | grep r816  
r8168 41104 0  
-> lspci -v  
01:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168B PCI
Express Gigabit Ethernet controller (rev 03)  
Subsystem: ASRock Incorporation Device 8168  
Kernel driver in use: r8169  
Kernel modules: r8169  
  
2) Download the official Realtek driver  
Realtek RTL8111/RTL8168  
  
3) Remove the r8169 module  
-> rmmod r8169  
-> mv /lib/modules/`uname -r`/kernel/drivers/net/r8169.ko ~/r8169.ko.backup  
( the ` is a backtick, it is not an apostrophe or single quote )  
  
4) Build the new r8168 module for the kernel  
-> bzip2 -d r8168-8.009.00.tar.bz2 （这儿的包名称有点儿变化,需要改动）  
-> tar -xf r8168-8.009.00.tar  
-> cd r8168-8.009.00  
-> make clean modules  
-> make install  
  
5) Rebuild the kernel module dependencies  
-> depmod -a  
-> insmod ./src/r8168.ko  
  
6) Remove the r8169 module from initrd  
-> mv /initrd.img ~/initrd.img.backup  
-> mkinitramfs -o /boot/initrd.img-`uname -r` `uname -r`  
  
7) Add r8168 module to /etc/modules  
-> echo "r8168" >> /etc/modules  
  
Reboot, You are done!  
  
9) Examine that ONLY the r8168 module is loaded for the interface  
-> lspci -v  
01:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168B PCI
Express Gigabit Ethernet controller (rev 03)  
Subsystem: ASRock Incorporation Device 8168  
Kernel driver in use: r8168  
Kernel modules: r8168  

  
步骤基本如下：  
首先得下载好这个型号网卡的官方驱动：网卡RTL8111/8168 官方驱动链接页  
而且进行时确保以root用户权限（最好先sudo su）。  

**代码:**

sudo su

  
1 删除r8169 模块，这个是系统自动加载的驱动  

**代码:**

rmmod r8169  
mv /lib/modules/`uname -r`/kernel/drivers/net/r8169.ko ~/r8169.ko.backup
（这儿的'uname -r' 换成你运行的内核版本代号）  

  
2 解压官方驱动软件包  
3 进入解压目录之后编译并安装驱动模块  

**代码:**

make clean modules  
make install  

  
4 将模块添加到内核中  

**代码:**

depmod -a  
insmod ./src/r8168.ko  

  
5 删除原来的initrd.img并生成那个initrd.img-你使用的内核版本号 文件，保存更改免得重启的时候出现我那种状况  

**代码:**

mv /initrd.img ~/initrd.img.backup  
mkinitramfs -o /boot/initrd.img-`uname -r` `uname -r` （这儿的'uname -r'
换成你运行的内核版本代号）  

  
6 在开机启动模块中添加r8168模块。  

**代码:**

echo "r8168" >> /etc/modules  

  
7 重启  
  
希望对这个型号的网卡上网问题有所帮助。  
成功后重启之后网络连接信息大致如图：  
其中驱动应该是r8168，而不是r8169.

