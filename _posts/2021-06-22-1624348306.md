---
title: Keepalived之——lvs/dr+keepalived搭建成功后，开启防火墙，虚拟IP不能访问，但是真实IP却可以访问
categories: 精通运维系列 精通高可用系列
tags: Keepalived LVS
---
转载请注明出处：https://blog.csdn.net/l1028386804/article/details/92673303

lvs/dr+keepalived搭建成功后，开启防火墙，虚拟IP不能访问，但是真实IP却可以访问，如果关闭防火墙虚拟IP就可以访问网站了，这个问题肯定是防火墙在作怪.

1.在lvs上执行

    
    
    iptables -t nat -A PREROUTING -p tcp -d 192.168.1.200 --dport 80 -j REDIRECT
    iptables -I INPUT -i eth0 -p tcp --dport 80 -j ACCEPT
    iptables -I OUTPUT -p tcp --sport 80 -j ACCEPT

2.在每台真实服务器上运行

    
    
    ifconfig lo:0 192.168.1.20（虚拟IP地址） netmask 255.255.255.255 up
    echo "1" > /proc/sys/net/ipv4/ip_forward

其余内容：

增加一条iptables策略，

    
    
    iptables -t nat -A PREROUTING -p tcp -d 虚拟服务ip --dport 80 -j REDIRECT 

`这样让iptables对虚拟服务ip彻底放行`

